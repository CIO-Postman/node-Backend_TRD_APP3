-- UPDATE TDASSET_FORMER.tdadmin.BLOCK_BLUE_47 
--     SET DEPTH_VALUE_TRUNC = TJOIN.VAL_PER_WAH
--     FROM TDASSET_FORMER.tdadmin.BLOCK_BLUE_47  TMAS 
--     LEFT OUTER JOIN (
--     SELECT BRANCH_CODE , BLOCK_BLUE_RN , MAX(VAL_PER_WAH ) VAL_PER_WAH FROM (
--     SELECT DENSE_RANK () OVER (PARTITION BY T3.BRANCH_CODE , T1.BLOCK_BLUE_RN ORDER BY T3.VAL_PER_WAH DESC ) ROWNUM , T3.BRANCH_CODE , T1.BLOCK_BLUE_RN , T3.PARCEL_RN , T3.VAL_PER_WAH FROM 
--     (
--         SELECT  T3.BRANCH_CODE , T3.BLOCK_BLUE_RN  FROM (  
--         SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_47_10
--         WHERE  BRANCH_CODE =@BRANCH_CODE
--          AND PARCEL_RN =@PARCEL_RN--A 
--         --WHERE OBJECTID = 13512
--         ) T1 
--         LEFT OUTER JOIN 
--         (
--             SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_REL_47 
--             WHERE BRANCH_CODE =@BRANCH_CODE
--             AND PARCEL_RN =@PARCEL_RN--A
--         ) T2
--         ON T1.BRANCH_CODE = T2.BRANCH_CODE
--         AND T1.PARCEL_RN = T2.PARCEL_RN  
--         LEFT OUTER JOIN 
--         (
--             SELECT * FROM TDASSET_FORMER.tdadmin.BLOCK_BLUE_47 
    
--         ) T3
--         ON T2.BRANCH_CODE = T3.BRANCH_CODE
--         AND T2.BLOCK_BLUE_RN = T3.BLOCK_BLUE_RN
--         WHERE T3.BLOCK_TYPE_ID = 1
--     ) T1 
--     LEFT OUTER JOIN 
--     (
--          SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_REL_47 WHERE BRANCH_CODE =@BRANCH_CODE AND PARCEL_RN =@PARCEL_RN--A
--     ) T2 
--     ON T1.BRANCH_CODE = T2.BRANCH_CODE 
--     AND T1.BLOCK_BLUE_RN = T2.BLOCK_BLUE_RN
--     LEFT OUTER JOIN 
--     (
--         SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_47_10 WHERE BRANCH_CODE =@BRANCH_CODE AND PARCEL_RN =@PARCEL_RN--A
--     ) T3
--     ON T2.BRANCH_CODE = T3.BRANCH_CODE 
--     AND T2.PARCEL_RN = T3.PARCEL_RN ) T
--     GROUP BY 		BRANCH_CODE , BLOCK_BLUE_RN	 ) TJOIN 
--     ON TMAS.BRANCH_CODE = TJOIN.BRANCH_CODE
--     AND TMAS.BLOCK_BLUE_RN = TJOIN.BLOCK_BLUE_RN
--     WHERE TMAS.BRANCH_CODE = TJOIN.BRANCH_CODE
--     AND TMAS.BLOCK_BLUE_RN = TJOIN.BLOCK_BLUE_RN
    
    
    
--     UPDATE TDASSET_FORMER.tdadmin.PARCEL_47_10
--     SET VAL_PER_WAH = TJOIN.NEW_VAL ,
--     LOG_PARCEL = NULL 
--     FROM TDASSET_FORMER.tdadmin.PARCEL_47_10  WHERE BRANCH_CODE =@BRANCH_CODE AND PARCEL_RN =@PARCEL_RN--A TMAS 
--     LEFT OUTER JOIN (
    
--     SELECT DENSE_RANK () OVER (PARTITION BY T3.BRANCH_CODE  , T1.BLOCK_BLUE_RN ORDER BY T3.VAL_PER_WAH DESC ) ROWNUM , T1.BRANCH_CODE , T1.BLOCK_BLUE_RN , T2.PARCEL_RN , T3.VAL_PER_WAH  , 
--     land.dbo.[LOWPRICE_TRUNC2](T1.DEPTH_VALUE_TRUNC*.60,0,1,T1.DEPTH_VALUE_TRUNC) NEW_VAL FROM ( 
--     SELECT * FROM TDASSET_FORMER.tdadmin.BLOCK_BLUE_47 
--     WHERE BRANCH_CODE =@BRANCH_CODE 
--     AND DEPTH_VALUE_TRUNC IS NOT NULL  ) T1
--     LEFT OUTER JOIN 
--     (
--          SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_REL_47
--          WHERE BRANCH_CODE =@BRANCH_CODE 
--          AND PARCEL_RN =@PARCEL_RN--A
--     ) T2
--     ON T1.BRANCH_CODE = T2.BRANCH_CODE
--     AND T1.BLOCK_BLUE_RN = T2.BLOCK_BLUE_RN 
--     LEFT OUTER JOIN 
--     (
--          SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_47_10
--          WHERE BRANCH_CODE =@BRANCH_CODE 
--          AND PARCEL_RN =@PARCEL_RN--A
--     ) T3
    
--     ON T2.BRANCH_CODE = T3.BRANCH_CODE
--     AND T2.PARCEL_RN = T3.PARCEL_RN ) TJOIN
--     ON TMAS.BRANCH_CODE = TJOIN.BRANCH_CODE
--     AND TMAS.PARCEL_RN = TJOIN.PARCEL_RN
--     WHERE TMAS.BRANCH_CODE = TJOIN.BRANCH_CODE
--     AND TMAS.PARCEL_RN = TJOIN.PARCEL_RN
--     AND TJOIN.ROWNUM > 1
    
    
--     UPDATE TDASSET_FORMER.tdadmin.PARCEL_REL_47
--     SET VAL_PER_WAH = TJOIN.VAL_PER_WAH 
--     FROM TDASSET_FORMER.tdadmin.PARCEL_REL_47 WHERE BRANCH_CODE =@BRANCH_CODE AND PARCEL_RN =@PARCEL_RN--A TMAS 
--     LEFT OUTER JOIN (
    
--     SELECT DENSE_RANK () OVER (PARTITION BY T3.BRANCH_CODE  , T1.BLOCK_BLUE_RN ORDER BY T3.VAL_PER_WAH DESC ) ROWNUM , T1.BRANCH_CODE , T1.BLOCK_BLUE_RN , T2.PARCEL_RN , T3.VAL_PER_WAH  , 
--     land.dbo.[LOWPRICE_TRUNC2](T1.DEPTH_VALUE_TRUNC*.60,0,1,T1.DEPTH_VALUE_TRUNC) NEW_VAL FROM ( 
--     SELECT * FROM TDASSET_FORMER.tdadmin.BLOCK_BLUE_47 
--     WHERE BRANCH_CODE =@BRANCH_CODE 
--     AND DEPTH_VALUE_TRUNC IS NOT NULL  ) T1
--     LEFT OUTER JOIN 
--     (
--          SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_REL_47
--          WHERE  BRANCH_CODE =@BRANCH_CODE
--          AND PARCEL_RN =@PARCEL_RN--A 
--     ) T2
--     ON T1.BRANCH_CODE = T2.BRANCH_CODE
--     AND T1.BLOCK_BLUE_RN = T2.BLOCK_BLUE_RN 
--     LEFT OUTER JOIN 
--     (
--          SELECT * FROM TDASSET_FORMER.tdadmin.PARCEL_47_10
--          WHERE  BRANCH_CODE =@BRANCH_CODE
--          AND PARCEL_RN =@PARCEL_RN--A
--     ) T3
    
--     ON T2.BRANCH_CODE = T3.BRANCH_CODE
--     AND T2.PARCEL_RN = T3.PARCEL_RN ) TJOIN
--     ON TMAS.BRANCH_CODE = TJOIN.BRANCH_CODE
--     AND TMAS.PARCEL_RN = TJOIN.PARCEL_RN
--     WHERE TMAS.BRANCH_CODE = TJOIN.BRANCH_CODE
--     AND TMAS.PARCEL_RN = TJOIN.PARCEL_RN
--     AND TJOIN.ROWNUM > 1
    
--     UPDATE TDASSET_FORMER.tdadmin.BLOCK_BLUE_47
--     SET DEPTH_VALUE_TRUNC = NULL 
--     WHERE DEPTH_VALUE_TRUNC IS NOT NULL